{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block title %}
    {% endblock %}

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

     <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
     <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
     <link rel="stylesheet" href="{% static 'assets/css/image-fixes.css' %}">
    <style>
        /* =========================
   TOAST CONTAINER
========================= */
#django-toast-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;

    display: flex;
    flex-direction: column;
    gap: 10px;

    pointer-events: none;
}

/* =========================
   BASE TOAST
========================= */
.django-toast {
    min-width: 280px;
    max-width: 420px;
    padding: 14px 18px;
    border-radius: 8px;

    font-size: 14px;
    font-weight: 500;
    color: #000; /* BLACK TEXT */

    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    opacity: 0;
    transform: translateY(-10px);
    animation: toast-slide 0.35s ease forwards;

    pointer-events: auto;
}

/* =========================
   MESSAGE TYPES
========================= */
.django-toast.success {
    background-color: #d1fae5; /* green */
}

.django-toast.error {
    background-color: #fee2e2; /* red */
}

.django-toast.warning {
    background-color: #fef3c7; /* yellow */
}

.django-toast.info {
    background-color: #e0f2fe; /* blue */
}

/* =========================
   FIELD ERROR (STRICT RED)
========================= */
.django-toast.field-error {
    background-color: #dc2626; /* strong red */
    color: #000;
}

/* =========================
   ANIMATION
========================= */
@keyframes toast-slide {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* =========================
   MOBILE MENU FIXES - FIXED VERSION
========================= */
#mobileMenu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 1000;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background-color: white;
    border-top: 1px solid #e5e7eb;
    display: none; /* Hidden by default */
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
}

#mobileMenu.show {
    display: block !important;
    opacity: 1;
    transform: translateY(0);
}

/* Ensure mobile menu links are visible */
#mobileMenu a {
    display: block;
    padding: 12px 16px;
    text-decoration: none;
    color: #374151; /* gray-700 */
    font-weight: bold;
    font-size: 14px;
    border-bottom: 1px solid #f3f4f6; /* gray-100 */
}

#mobileMenu a:hover {
    color: #1e40af; /* aviation-blue */
    background-color: #f9fafb; /* gray-50 */
}

/* Remove last border */
#mobileMenu a:last-child {
    border-bottom: none;
}

/* Make sure the header has relative positioning for absolute dropdown */
.sticky-header {
    position: relative;
}
    </style>
</head>
<body class="bg-white text-gray-800">
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/69749b126d15d9197bca22de/1jfnnrge0';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
    <div class="bg-gray-800 text-gray-300 text-xs py-2 px-4 text-center">
        FREE SHIPPING for online orders exceeding £50 ex VAT delivered within the UK - Minimum order value £20
    </div>


    <!-- Header -->
    <header class="sticky-header bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4 flex flex-col lg:flex-row items-center justify-between">
            <!-- Logo -->
            <div class="flex-shrink-0 mb-4 lg:mb-0">
                <a href="{% url 'product:home' %}" class="flex items-center gap-2 text-aviation-blue hover:opacity-90 transition-opacity">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" class="text-aviation-blue">
                        <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                    </svg>
                    <div class="flex flex-col leading-none">
                        <span class="text-2xl font-black italic tracking-tighter">AVIATION</span>
                        <span class="text-[0.6rem] tracking-widest text-gray-500 font-bold uppercase">Spares & Repairs</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center space-x-6 text-sm font-bold text-gray-700">
                <a href="{% url 'product:home' %}" class="hover:text-aviation-blue transition-colors text-aviation-blue">HOME</a>
                <a href="{% url 'product:products' %}" class="hover:text-aviation-blue transition-colors">PRODUCTS</a>
<!--                <a href="{% url 'accounts:register' %}" class="hover:text-aviation-blue transition-colors">A-Z LISTING</a>-->
                <a href="{% url 'product:capability' %}" class="hover:text-aviation-blue transition-colors">CAPABILITIES</a>
                <a href="{% url 'product:news' %}" class="hover:text-aviation-blue transition-colors">LATEST NEWS</a>
                <a href="{% url 'product:about' %}" class="hover:text-aviation-blue transition-colors">ABOUT US</a>
                <a href="{% url 'product:contact' %}" class="hover:text-aviation-blue transition-colors">CONTACT US</a>
                {% if not request.user.is_authenticated %}
                <a href="{% url 'accounts:login' %}" class="hover:text-aviation-blue transition-colors">LOGIN</a>
                {% else %}
                <a href="{% url 'accounts:logout' %}" class="hover:text-aviation-blue transition-colors">LOGOUT</a>
                {% endif %}
            </nav>

            <!-- Search & Cart -->
            <div class="flex items-center space-x-4">
                <div class="relative flex items-center">
                    <input
                        type="text"
                        placeholder="KEYWORD/PART NUMBER"
                        id="searchInput"
                        class="border border-gray-300 rounded-l px-3 py-1.5 text-xs w-48 focus:outline-none focus:border-aviation-blue"
                    >
                    <button
                        id="searchButton"
                        class="bg-gray-100 border border-l-0 border-gray-300 rounded-r px-2 py-1.5 hover:bg-gray-200"
                    >
                        <i class="fas fa-search text-gray-500"></i>
                    </button>

                    <!-- Search Results Dropdown -->
                    <div id="searchResults" class="hidden absolute top-full right-0 mt-2 w-64 bg-white border border-aviation-blue p-3 shadow-lg rounded z-50">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs font-bold text-aviation-blue uppercase">Search Results</span>
                        </div>
                        <div id="searchResultContent" class="text-xs text-gray-700 leading-relaxed">
                            <!-- Results will appear here -->
                        </div>
                    </div>
                </div>

                <a href="{% url 'cart:cart_summary' %}" id="cart-icon-container" class="relative cursor-pointer">
                    <i class="fas fa-shopping-cart text-gray-700 text-xl"></i>
                    <span id="cart-count" class="absolute -top-1 -right-2 bg-gray-800 text-white text-[0.6rem] font-bold px-1.5 rounded-full">{{cart.total_quantities}}</span>
                </a>

                <!-- Mobile Menu Button -->
                <button id="mobileMenuButton" class="lg:hidden ml-4 text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobileMenu" class="lg:hidden">
            <nav class="flex flex-col p-4 space-y-2">
                <a href="{% url 'product:home' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">HOME</a>
                <a href="{% url 'product:products' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">PRODUCTS</a>
<!--                <a href="pages/navbar/listing.html" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">A-Z LISTING</a>-->
                <a href="{% url 'product:capability' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">CAPABILITIES</a>
                <a href="{% url 'product:news' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">LATEST NEWS</a>
                <a href="{% url 'product:about' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">ABOUT US</a>
                <a href="{% url 'product:contact' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">CONTACT US</a>
                {% if not request.user.is_authenticated %}
                <a href="{% url 'accounts:login' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">LOGIN</a>
                {% else %}
                <a href="{% url 'accounts:logout' %}" class="block text-sm font-bold text-gray-700 hover:text-aviation-blue py-2">LOGOUT</a>
                {% endif %}
            </nav>
        </div>
    </header>
    <div id="main-header"></div>
    <script src="{% static 'assets/js/importer.js' %}"></script>

    <!-- Django Messages Toast -->
    {% if messages %}
    <div id="django-toast-container">
        {% for message in messages %}
            <div class="django-toast {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

  {% block content %}
  {% endblock %}

      <footer class="bg-gray-100 pt-12 pb-6 text-gray-700 text-sm font-sans border-t border-gray-200">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">

                <div class="space-y-2">
                    <h4 class="font-bold text-gray-800 mb-4">Quick Links</h4>
                    <a href="{% url 'product:contact' %}" class="block hover:text-aviation-blue transition-colors">Contact Us</a>
                    <a href="{% url 'product:company' %}" class="block hover:text-aviation-blue transition-colors">Company</a>
                    <a href="{% url 'product:about' %}" class="block hover:text-aviation-blue transition-colors">About Us</a>
                    <a href="{% url 'product:quality' %}" class="block hover:text-aviation-blue transition-colors">Quality</a>
                    <a href="{% url 'product:news' %}" class="block hover:text-aviation-blue transition-colors">News</a>
                </div>

                <div class="space-y-2">
                    <h4 class="font-bold text-gray-800 mb-4">Policies</h4>
                    <a href="{% url 'product:privacy' %}" class="block hover:text-aviation-blue transition-colors">Privacy Policy</a>
                    <a href="{% url 'product:website' %}" class="block hover:text-aviation-blue transition-colors">Website Terms & Conditions</a>
                    <a href="{% url 'product:terms_sales' %}" class="block hover:text-aviation-blue transition-colors">Terms & Conditions Of Sales</a>
                    <a href="{% url 'product:purchase_terms' %}" class="block hover:text-aviation-blue transition-colors">Terms & Conditions Of Purchase</a>
                    <a href="{% url 'product:anti_bribery' %}" class="block hover:text-aviation-blue transition-colors">Anti-Bribery Policy</a>
                </div>

                <div class="space-y-2">
                    <h4 class="font-bold text-gray-800 mb-4">Environment & Safety</h4>
                    <a href="{% url 'product:environmental' %}" class="block hover:text-aviation-blue transition-colors">Environmental Policy</a>
                    <a href="{% url 'product:equal_opportunities' %}" class="block hover:text-aviation-blue transition-colors">Equal Opportunities Policy</a>
                    <a href="{% url 'product:health' %}" class="block hover:text-aviation-blue transition-colors">Health and Safety Policy</a>
                    <a href="{% url 'product:obsolescence' %}" class="block hover:text-aviation-blue transition-colors">Obsolescence Management Policy</a>
                    <a href="{% url 'product:risk_management' %}" class="block hover:text-aviation-blue transition-colors">Risk Management Policy</a>
                </div>

                <div class="text-xs text-gray-600 leading-relaxed">
                    <h4 class="font-bold text-gray-800 mb-4">Contact Information</h4>
                    <p class="mb-2">Unit 6 Westlink, Romsey, Hampshire, SO51 7AA.</p>

                    <p class="mb-2">
                        <a href="mailto:sales@aviationspares.com" class="text-aviation-blue hover:underline">sales@aviationspares.com</a>
                    </p>
                </div>
            </div>

            <div class="mt-16 pt-8 border-t border-gray-200 text-center text-xs text-gray-500 flex flex-col md:flex-row justify-between items-center">
                <span>© Aviation Spares & Repairs 2025</span>
                <div class="flex flex-wrap justify-center space-x-6 mt-4 md:mt-0">
                    <span>VAT No: 857 7031 07</span>
                    <span>Cage Code: KCV81</span>
                    <span>DUNS No: 345372606</span>
                    <span>Company Reg No: 05347543</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
    // SIMPLE MOBILE MENU TOGGLE - This will definitely work
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');

        console.log('Mobile menu button:', mobileMenuButton);
        console.log('Mobile menu element:', mobileMenu);

        if (mobileMenuButton && mobileMenu) {
            // Toggle mobile menu when button is clicked
            mobileMenuButton.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log('Menu button clicked');

                // Toggle the 'show' class
                mobileMenu.classList.toggle('show');

                // Change the icon
                const icon = mobileMenuButton.querySelector('i');
                if (mobileMenu.classList.contains('show')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                    console.log('Menu shown');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                    console.log('Menu hidden');
                }
            });

            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!mobileMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
                    mobileMenu.classList.remove('show');
                    const icon = mobileMenuButton.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // Close menu when clicking on a link
            const menuLinks = mobileMenu.querySelectorAll('a');
            menuLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    mobileMenu.classList.remove('show');
                    const icon = mobileMenuButton.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                });
            });
        } else {
            console.error('Mobile menu elements not found!');
        }

        // Existing toast functionality
        const toasts = document.querySelectorAll(".django-toast");
        toasts.forEach(toast => {
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateY(-10px)";
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        });
    });



    const qtyInput = document.getElementById("quantity");
    const minusBtn = document.getElementById("qty-minus");
    const plusBtn = document.getElementById("qty-plus");

    minusBtn.addEventListener("click", () => {
        let current = parseInt(qtyInput.value) || 1;
        if (current > parseInt(qtyInput.min)) {
            qtyInput.value = current - 1;
        }
    });

    plusBtn.addEventListener("click", () => {
        let current = parseInt(qtyInput.value) || 1;
        qtyInput.value = current + 1;
    });


const addToCartBtn = document.getElementById("add-to-cart");
const cartCount = document.getElementById("cart-count");

addToCartBtn.addEventListener("click", function () {
    const productId = this.dataset.productId;
    const quantity = parseInt(document.getElementById("quantity").value, 10);

    fetch("{% url 'cart:cart_add' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: new URLSearchParams({
            action: "post",
            product_id: productId,
            quantity: quantity
        })
    })
    .then(res => res.json())
    .then(data => {
        console.log("Added:", data);

        // Update cart count **inside the .then()** after getting data
        if (cartCount && data.qty !== undefined) {
            cartCount.textContent = data.qty;
        }
    })
    .catch(err => console.error("Cart error:", err));
});




    </script>

    <script src="{% static 'assets/js/fix-images.js' %}"></script>
    <script src="{% static 'assets/js/performance.js' %}"></script>
    <script src="{% static 'assets/js/global-fixes.js' %}"></script>
    <script src="{% static 'assets/js/aviation-products-data.js' %}"></script>
</body>
</html>